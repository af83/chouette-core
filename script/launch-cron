#!/bin/bash

function append_var_if_defined
{
    VAR_NAME=$1
    OUTPUT=$2
    env|grep -E "^${VAR_NAME}=">>${OUTPUT}
}
VAR_LIST="RAILS_DB_HOST RAILS_DB_PORT RAILS_DB_USER RAILS_DB_PASSWORD RAILS_DB_NAME API_KEYS ISSUE_CATEGORIES MAIL_HOST MAIL_ASSETS_URL_BASE MAIL_FROM SMTP_HOST LDAP_INT_HOST LDAP_INT_PORT LDAP_INT_BASE LDAP_EXT_HOST LDAP_EXT_USER LDAP_EXT_PASSWORD LDAP_EXT_BASE LDAP_EXT_OBJECT_CLASS SECRET_BASE SIDEKIQ_REDIS_URL CODIFLIGNE_API_URL SWAGGER_PATH REDIS_CACHE_STORE_URL CACHE_STORE_TIMEOUT RAILS_LOG_TO_STDOUT"

TMPF=$(tempfile)
for v in $VAR_LIST; do
    append_var_if_defined $v $TMPF   
done

crontab -l >> $TMPF
cat $TMPF |crontab -
rm $TMPF

exec cron -f
